{% extends 'base.html' %} {% load static %} {% block content %} {% include 'navbar.html' %}

<title>Balink | Product Page</title>
<div class="container mx-auto mt-6 flex flex-col md:flex-row">
  <!-- Sidebar for Filters -->
  <div class="w-full md:w-1/3 h-screen p-6 bg-white rounded-lg shadow-lg md:sticky top-0">
    <h2 class="text-lg font-bold mb-4 text-gray-800">Filter Products</h2>
    <form method="GET" class="mb-6">
      <div class="mb-4 flex flex-col">
        <input type="text" name="search" id="search" placeholder="Search for products..." class="border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-400" value="{{ search_query }}" oninput="fetchSuggestions()" />
        <div id="suggestions" class="absolute z-10 bg-white border border-gray-300 rounded-lg w-full mt-1 hidden"></div>
      </div>

      <div class="mb-4 flex justify-between flex-wrap">
        <div class="w-full md:w-1/2 pr-2">
          <label for="min_price" class="block text-sm font-medium text-gray-700">Min Price</label>
          <input type="number" name="min_price" id="min_price" class="mt-1 block w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-400" placeholder="0" value="{{ request.GET.min_price }}" />
        </div>
        <div class="w-full md:w-1/2 pl-2 mt-4 md:mt-0">
          <label for="max_price" class="block text-sm font-medium text-gray-700">Max Price</label>
          <input type="number" name="max_price" id="max_price" class="mt-1 block w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-400" placeholder="100000" value="{{ request.GET.max_price }}" />
        </div>
      </div>

      <div class="mb-4 flex justify-between flex-wrap">
        <div class="w-full md:w-1/2 pr-2">
          <label for="min_year" class="block text-sm font-medium text-gray-700">Min Year</label>
          <input type="number" name="min_year" id="min_year" class="mt-1 block w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-400" placeholder="2000" value="{{ request.GET.min_year }}" />
        </div>
        <div class="w-full md:w-1/2 pl-2 mt-4 md:mt-0">
          <label for="max_year" class="block text-sm font-medium text-gray-700">Max Year</label>
          <input type="number" name="max_year" id="max_year" class="mt-1 block w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-400" placeholder="2023" value="{{ request.GET.max_year }}" />
        </div>
      </div>

      <div class="mb-4 flex justify-between flex-wrap">
        <div class="w-full md:w-1/2 pr-2">
          <label for="min_km" class="block text-sm font-medium text-gray-700">Min KM Driven</label>
          <input type="number" name="min_km" id="min_km" class="mt-1 block w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-400" placeholder="0" value="{{ request.GET.min_km }}" />
        </div>
        <div class="w-full md:w-1/2 pl-2 mt-4 md:mt-0">
          <label for="max_km" class="block text-sm font-medium text-gray-700">Max KM Driven</label>
          <input type="number" name="max_km" id="max_km" class="mt-1 block w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-400" placeholder="100000" value="{{ request.GET.max_km }}" />
        </div>
      </div>

      <div class="flex justify-between mt-4">
        <button type="submit" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">Apply Filters</button>
        <a href="{% url 'product:show_product_page' %}" class="w-1/3 ml-2 bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500 transition text-center">Reset</a>
      </div>
    </form>

    <!-- Promotional Section -->
    <div class="mt-8 p-6 bg-yellow-100 rounded-lg shadow-md">
      <h3 class="text-lg font-semibold text-yellow-600 mb-2">Don't Miss Out!</h3>
      <p class="text-gray-700">Book your exclusive ride from BaLink today!</p>
      <a href="{% url 'bookmarks:show_main' %}" class="mt-4 inline-block bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition">Book now</a>
    </div>
  </div>
  <br><br>
  <!-- Carousel Content -->
  <div class="flex-1 ml-0 md:ml-6">
    <div class="relative bg-gradient-to-r from-blue-700 to-blue-500 rounded-xl overflow-hidden shadow-lg mb-6">
      <div class="carousel-wrapper overflow-hidden relative">
        <div class="carousel-slide flex transition-transform duration-700 ease-in-out">
          <!-- Slide 1 -->
          <div class="w-full flex-shrink-0 flex items-center justify-between space-x-8 bg-gradient-to-br from-blue-600 to-blue-700 text-white rounded-lg p-10 transform transition duration-300 hover:scale-105 hover:shadow-xl">
            <div class="flex-1">
              <h2 class="text-4xl md:text-5xl font-bold tracking-tight mb-4 leading-tight">Exclusive Transportation Collection</h2>
              <h5 class="text-xl md:text-2xl font-semibold mb-4 text-blue-300">Elevate Your Experience</h5>
              <p class="text-gray-300 mb-6 leading-relaxed">Premium range of transportation options for all occasions.</p>
              <a href="#" class="bg-yellow-500 hover:bg-yellow-600 text-gray-900 px-6 py-3 rounded-lg font-bold shadow-lg transition-transform transform hover:scale-110">Explore Now</a>
            </div>
            <div class="relative hidden md:block">
              <img src="{% static 'img/traveler2.png' %}" alt="Featured Transport" class="w-full h-auto object-cover rounded-xl transform hover:scale-110 transition duration-300 ease-in-out" />
            </div>
          </div>

          <!-- Slide 2 -->
          <div class="w-full flex-shrink-0 flex items-center justify-between space-x-8 bg-gradient-to-br from-blue-700 to-blue-600 text-white rounded-lg p-10 transform transition duration-300 hover:scale-105 hover:shadow-xl">
            <div class="flex-1">
              <h2 class="text-4xl md:text-5xl font-bold tracking-tight mb-4 leading-tight">Modern Designs</h2>
              <h5 class="text-xl md:text-2xl font-semibold mb-4 text-blue-300">Travel with Ease</h5>
              <p class="text-gray-300 mb-6 leading-relaxed">Experience our latest transportation styles and designs.</p>
              <a href="#" class="bg-yellow-500 hover:bg-yellow-600 text-gray-900 px-6 py-3 rounded-lg font-bold shadow-lg transition-transform transform hover:scale-110">Discover Now</a>
            </div>
            <div class="relative hidden md:block">
              <img src="{% static 'img/traveler.png' %}" alt="Modern Transport" class="w-full h-auto object-cover rounded-xl transform hover:scale-110 transition duration-300 ease-in-out" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Product Button -->
    <div class="container mx-auto mt-6 flex justify-end items-center">
      <button
        data-modal-target="crudModal"
        data-modal-toggle="crudModal"
        class="btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-105"
        onclick="showModal();"
      >
        Add New Product
      </button>
    </div>

    <!-- Modal (Hidden by default) -->
    <div id="crudModal" tabindex="-1" aria-hidden="true" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-50 overflow-x-hidden overflow-y-auto">
      <div id="crudModalContent" class="relative bg-white rounded-lg shadow-lg w-full max-w-lg mx-4 transform scale-95 opacity-0 transition-transform transition-opacity duration-300 ease-out">
        <!-- Modal header -->
        <div class="flex items-center justify-between p-4 border-b rounded-t">
          <h3 class="text-xl font-semibold text-gray-900">Add New Product</h3>
          <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center" id="closeModalBtn">
            <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
              <path
                fill-rule="evenodd"
                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                clip-rule="evenodd"
              ></path>
            </svg>
            <span class="sr-only">Close modal</span>
          </button>
        </div>
        <!-- Modal body -->
        <div class="px-6 py-4 space-y-6 form-style">
          <form id="addProductForm">
            <div class="mb-4">
              <label for="image_url" class="block text-sm font-medium text-gray-700">Image URL</label>
              <input type="url" id="image_url" name="image_url" class="mt-1 block w-full border border-gray-300 rounded-md p-2 hover:border-blue-700" placeholder="Enter product image URL" required />
            </div>
            <div class="mb-4">
              <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
              <input type="text" id="name" name="name" class="mt-1 block w-full border border-gray-300 rounded-md p-2 hover:border-blue-700" placeholder="Enter product name" required />
            </div>
            <div class="mb-4">
              <label for="year" class="block text-sm font-medium text-gray-700">Year</label>
              <input type="number" id="year" name="year" class="mt-1 block w-full border border-gray-300 rounded-md p-2 hover:border-blue-700" placeholder="Enter the year (1886-2024)" required />
            </div>
            <div class="mb-4">
              <label for="price" class="block text-sm font-medium text-gray-700">Price (Rp/day)</label>
              <input type="number" id="price" name="price" class="mt-1 block w-full border border-gray-300 rounded-md p-2 hover:border-blue-700" placeholder="Enter the price (positive values only)" required />
            </div>
            <div class="mb-4">
              <label for="km_driven" class="block text-sm font-medium text-gray-700">KM Driven</label>
              <input type="number" id="km_driven" name="km_driven" class="mt-1 block w-full border border-gray-300 rounded-md p-2 hover:border-blue-700" placeholder="Enter the number of kilometers driven (positive values only)" required />
            </div>
            <div class="mb-4">
              <label for="dealer" class="block text-sm font-medium text-gray-700">Dealer</label>
              <input type="text" id="dealer" name="dealer" class="mt-1 block w-full border border-gray-300 rounded-md p-2 hover:border-blue-700" placeholder="Enter dealer name" required />
            </div>
          </form>
        </div>
        <!-- Modal footer -->
        <div class="flex flex-col space-y-2 md:flex-row md:space-y-0 md:space-x-2 p-6 border-t border-gray-200 rounded-b justify-center md:justify-end">
          <button type="button" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg" id="cancelButton">Cancel</button>
          <button type="submit" id="submitProductEntry" form="addProductForm" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Save</button>
        </div>
      </div>
    </div>

    <h2 class="text-3xl font-bold text-center mb-6 text-yellow-500">Our <span class="text-blue-600">Products</span></h2>
    <div id="product_entry"></div>
  </div>
</div>

<script>
  let currentIndex = 0;
  const slides = document.querySelectorAll(".carousel-slide > div");

  function showSlide(index) {
    const offset = -index * 100;
    document.querySelector(".carousel-slide").style.transform = `translateX(${offset}%)`;
  }

  function nextSlide() {
    currentIndex = (currentIndex + 1) % slides.length;
    showSlide(currentIndex);
  }

  // Automatically move to the next slide every 5 seconds (5000 ms)
  setInterval(nextSlide, 5000);

  async function getProduct() {
    // Construct URL with query parameters
    const url = new URL("{% url 'product:show_json' %}", window.location.origin);

    const searchQuery = document.getElementById("search").value;
    const minPrice = document.getElementById("min_price").value;
    const maxPrice = document.getElementById("max_price").value;
    const minYear = document.getElementById("min_year").value;
    const maxYear = document.getElementById("max_year").value;
    const minKm = document.getElementById("min_km").value;
    const maxKm = document.getElementById("max_km").value;

    if (searchQuery) url.searchParams.append("search", searchQuery);
    if (minPrice) url.searchParams.append("min_price", minPrice);
    if (maxPrice) url.searchParams.append("max_price", maxPrice);
    if (minYear) url.searchParams.append("min_year", minYear);
    if (maxYear) url.searchParams.append("max_year", maxYear);
    if (minKm) url.searchParams.append("min_km", minKm);
    if (maxKm) url.searchParams.append("max_km", maxKm);

    // Fetch products
    return fetch(url)
      .then((res) => res.json())
      .catch((error) => {
        console.error("Error fetching products:", error);
      });
  }

  async function refreshProduct() {
    document.getElementById("product_entry").innerHTML = "";
    document.getElementById("product_entry").className = "";
    const productEntries = await getProduct();
    let htmlString = "";
    let classNameString = "";

    if (productEntries.length === 0) {
      classNameString = "container mx-auto mt-6";
      htmlString = `
<div class="product-card bg-white rounded-lg shadow-md overflow-hidden transition-transform transform hover:scale-105 hover:shadow-xl border border-gray-200 p-4">
  <div class="flex items-center justify-center h-full text-center">
    <div class="mr-2">
      <img src="{% static 'img/default-placeholder.png' %}" alt="No Products Icon" class="w-12 h-12" /> <!-- Replace with your icon -->
    </div>
    <div>
      <p class="text-gray-600 font-medium">No products available at this time.</p>
      <p class="text-gray-400 text-sm">Try checking back later or add a new product!</p>
    </div>
  </div>
</div>
        `;
    } else {
      classNameString = "container mx-auto mt-6 product-list grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6";
      productEntries.forEach((item) => {
        const name = DOMPurify.sanitize(item.fields.name);
        const image_url = DOMPurify.sanitize(item.fields.image_url);
        const year = DOMPurify.sanitize(item.fields.year);
        const price = DOMPurify.sanitize(item.fields.price);
        const km_driven = DOMPurify.sanitize(item.fields.km_driven);
        const dealer = DOMPurify.sanitize(item.fields.dealer);
        htmlString += `
    <div class="product-card bg-white rounded-lg shadow-md overflow-hidden transition-transform transform hover:scale-105 hover:shadow-xl border border-gray-200">
  <div class="relative">
    <img src="${item.fields.image_url}" alt="${item.fields.name}" class="product-image w-full h-48 object-cover" loading="lazy" />
  </div>
  <div class="product-info p-4">
    <h2 class="product-name text-lg font-semibold text-gray-800 hover:text-blue-600 transition duration-200">
      ${item.fields.name}
    </h2>
    <p class="product-year text-gray-600">
      Year: <span class="font-semibold">${item.fields.year}</span>
    </p>
    <p class="product-price text-gray-800 font-bold text-xl">
      Price: <span class="text-blue-600">Rp.${item.fields.price}/day</span>
    </p>
    <p class="product-km text-gray-600">
      KM Driven: <span class="font-semibold">${item.fields.km_driven}</span>
    </p>
    <p class="product-dealer text-gray-600">
      Dealer: <span class="font-semibold">${item.fields.dealer}</span>
    </p>
  </div>
  <div class="card-footer p-4 flex justify-between items-center">
{% if user.privilege == 'customer' %}
    <a href="/product/detail/${item.pk}">
        <button class="rent-button bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
            View Detail
        </button>
    </a>
{% else %}
   <div class="flex items-center space-x-2">
    <a href="/product/edit/${item.pk}">
        <button class="rent-button bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
            Edit
        </button>
    </a>
    <a href="/product/delete_product/${item.pk}" aria-label="Delete product" class="bg-red-500 hover:bg-red-600 text-white rounded-full p-2 transition duration-300 shadow-md flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
        </svg>
    </a>
</div>

{% endif %}

  </div>
</div>`;
      });
    }
    document.getElementById("product_entry").className = classNameString;
    document.getElementById("product_entry").innerHTML = htmlString;
  }
  refreshProduct();

  const modal = document.getElementById("crudModal");
  const modalContent = document.getElementById("crudModalContent");

  function showModal() {
    const modal = document.getElementById("crudModal");
    const modalContent = document.getElementById("crudModalContent");

    modal.classList.remove("hidden");
    setTimeout(() => {
      modalContent.classList.remove("opacity-0", "scale-95");
      modalContent.classList.add("opacity-100", "scale-100");
    }, 50);
  }

  function hideModal() {
    const modal = document.getElementById("crudModal");
    const modalContent = document.getElementById("crudModalContent");

    modalContent.classList.remove("opacity-100", "scale-100");
    modalContent.classList.add("opacity-0", "scale-95");

    setTimeout(() => {
      modal.classList.add("hidden");
    }, 150);
  }

  document.getElementById("cancelButton").addEventListener("click", hideModal);
  document.getElementById("closeModalBtn").addEventListener("click", hideModal);

  function addProduct() {
    fetch("{% url 'product:add_product' %}", {
      method: "POST",
      body: new FormData(document.querySelector("#addProductForm")),
    }).then((response) => refreshProduct());

    document.getElementById("addProductForm").reset();
    document.querySelector("[data-modal-toggle='crudModal']").click();

    return false;
  }

  document.getElementById("addProductForm").addEventListener("submit", (e) => {
    e.preventDefault();
    addProduct();
  });
</script>
{% endblock %}
