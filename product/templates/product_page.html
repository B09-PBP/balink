{% extends 'base.html' %}
{% load static %}
{% block content %}
{% include 'navbar.html' %}

<div class="container mx-auto mt-6 flex">
    <!-- Sidebar for Filters -->
    <div class="w-1/3 h-screen p-6 bg-gray-100 rounded-lg shadow-md sticky top-0">
        <h2 class="text-lg font-bold mb-4">Filter Products</h2>
        <form method="GET">
            <div class="mb-4">
                <label for="min_price" class="block text-sm font-medium text-gray-700">Min Price</label>
                <input type="number" name="min_price" id="min_price" class="mt-1 block w-full border border-gray-300 rounded-md p-2" placeholder="0" value="{{ request.GET.min_price }}">
            </div>
            <div class="mb-4">
                <label for="max_price" class="block text-sm font-medium text-gray-700">Max Price</label>
                <input type="number" name="max_price" id="max_price" class="mt-1 block w-full border border-gray-300 rounded-md p-2" placeholder="100000" value="{{ request.GET.max_price }}">
            </div>
            <div class="mb-4">
                <label for="min_year" class="block text-sm font-medium text-gray-700">Min Year</label>
                <input type="number" name="min_year" id="min_year" class="mt-1 block w-full border border-gray-300 rounded-md p-2" placeholder="2000" value="{{ request.GET.min_year }}">
            </div>
            <div class="mb-4">
                <label for="max_year" class="block text-sm font-medium text-gray-700">Max Year</label>
                <input type="number" name="max_year" id="max_year" class="mt-1 block w-full border border-gray-300 rounded-md p-2" placeholder="2023" value="{{ request.GET.max_year }}">
            </div>
            <div class="mb-4">
                <label for="min_km" class="block text-sm font-medium text-gray-700">Min KM Driven</label>
                <input type="number" name="min_km" id="min_km" class="mt-1 block w-full border border-gray-300 rounded-md p-2" placeholder="0" value="{{ request.GET.min_km }}">
            </div>
            <div class="mb-4">
                <label for="max_km" class="block text-sm font-medium text-gray-700">Max KM Driven</label>
                <input type="number" name="max_km" id="max_km" class="mt-1 block w-full border border-gray-300 rounded-md p-2" placeholder="100000" value="{{ request.GET.max_km }}">
            </div>
            <button type="submit" class="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Apply Filters</button>
        </form>
    </div>

    <div class="flex-1 ml-6">
        <div class="relative bg-gradient-to-r from-indigo-800 via-indigo-600 to-gray-800 rounded-xl overflow-hidden shadow-2xl mb-6">
            <!-- Carousel Content -->
            <div class="carousel-wrapper overflow-hidden relative">
                <div class="carousel-slide flex transition-transform duration-700 ease-in-out">
                    <!-- Slide 1 -->
                    <div class="w-full flex-shrink-0 flex items-center justify-between space-x-8 bg-gradient-to-br from-indigo-600 to-indigo-800 text-white rounded-lg p-10 transform transition duration-300 hover:scale-105">
                        <div>
                            <h2 class="text-4xl md:text-5xl font-bold tracking-tight mb-4 leading-tight">Exclusive Transportation Collection</h2>
                            <h5 class="text-xl md:text-2xl font-semibold mb-4 text-indigo-300">Elevate Your Experience</h5>
                            <p class="text-gray-300 mb-6 leading-relaxed">Browse our premium range of transportation options for all occasions.</p>
                            <a href="#" class="bg-yellow-500 hover:bg-yellow-600 text-gray-900 px-6 py-3 rounded-lg font-bold shadow-lg transition-transform transform hover:scale-110">Explore Now</a>
                        </div>
                        <div class="relative">
                            <img src="https://via.placeholder.com/ 240" alt="Featured Transport" class="w-80 h-80 object-cover rounded-xl shadow-lg transform hover:scale-110 transition duration-300 ease-in-out" />
                            <div class="absolute top-4 right-4 bg-red-600 text-white px-4 py-2 rounded-full font-semibold text-xs shadow-md">54% Off</div>
                        </div>
                    </div>

                    <!-- Slide 2 -->
                    <div class="w-full flex-shrink-0 flex items-center justify-between space-x-8 bg-gradient-to-br from-indigo-800 to-indigo-600 text-white rounded-lg p-10 transform transition duration-300 hover:scale-105">
                        <div>
                            <h2 class="text-4xl md:text-5xl font-bold tracking-tight mb-4 leading-tight">Modern & Stylish Designs</h2>
                            <h5 class="text-xl md:text-2xl font-semibold mb-4 text-indigo-300">Travel with Ease</h5>
                            <p class="text-gray-300 mb-6 leading-relaxed">Experience our latest transportation styles and designs.</p>
                            <a href="#" class="bg-teal-500 hover:bg-teal-600 text-gray-100 px-6 py-3 rounded-lg font-bold shadow-lg transition-transform transform hover:scale-110">Discover Now</a>
                        </div>
                        <div class="relative">
                            <img src="https://via.placeholder.com/240" alt="Modern Transport" class="w-80 h-80 object-cover rounded-xl shadow-lg transform hover:scale-110 transition duration-300 ease-in-out" />
                            <div class="absolute top-4 right-4 bg-red-600 text-white px-4 py-2 rounded-full font-semibold text-xs shadow-md">30% Off</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container mx-auto mt-6">
            <form method="GET" class="flex justify-center mb-4 relative">
                <input type="text" name="search" id="search" placeholder="Search for products..." class="border border-gray-300 rounded-lg p-2 w-full md:w-1/2" value="{{ search_query }}" oninput="fetchSuggestions()" />
                <button type="submit" class="hidden">Search</button>
                <div id="suggestions" class="absolute z-10 bg-white border border-gray-300 rounded-lg w-full md:w-1/2 mt-1 hidden"></div>
            </form>
        </div>

        <div class="container mx-auto mt-6">
            <h2 class="text-3xl font-bold text-center mb-6">Our Products</h2>
            <div class="product-list grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="product-list">
                {% for product in products %}
                <div class="product-card bg-white rounded-lg shadow-md overflow-hidden transition-transform transform hover:scale-105 hover:shadow-xl">
                    <img src="{{ product.image_url }}" alt="{{ product.name }}" class="product-image w-full h-48 object-cover" />
                    <div class="product-info p-4">
                        <h2 class="product-name text-lg font-semibold">{{ product.name }}</h2>
                        <p class="product-year text-gray-600">Year: {{ product.year }}</p>
                        <p class="product-price text-gray-800 font-bold">Price: {{ product.price }}</p>
                        <p class="product-km text-gray-600">KM Driven: {{ product.km_driven }}</p>
                        <p class="product-dealer text-gray-600">Dealer: {{ product.dealer }}</p>
                    </div>
                    <div class="card-footer p-4">
                        <button class="rent-button bg-blue-600 text-white px-4 py-2 rounded">Rent Now</button>
                    </div>
                </div>
                {% empty %}
                <p class="text-gray-600">No products available at this time.</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
    let currentIndex = 0;
    const slides = document.querySelectorAll(".carousel-slide > div");

    function showSlide(index) {
        const offset = -index * 100;
        document.querySelector(".carousel-slide").style.transform = `translateX(${offset}%)`;
    }

    function nextSlide() {
        currentIndex = (currentIndex + 1) % slides.length;
        showSlide(currentIndex);
    }

    // Automatically move to the next slide every 5 seconds (5000 ms)
    setInterval(nextSlide, 5000);
</script>

<script>
    function fetchSuggestions() {
        const searchInput = document.getElementById("search").value ;
        const suggestionsContainer = document.getElementById("suggestions");

        if (searchInput.length < 1) {
            suggestionsContainer.innerHTML = "";
            suggestionsContainer.classList.add("hidden");
            return;
        }

        fetch(`/search/?query=${searchInput}`)
            .then((response) => response.json())
            .then((data) => {
                suggestionsContainer.innerHTML = "";
                if (data.length > 0) {
                    data.forEach((product) => {
                        const suggestionItem = document.createElement("div");
                        suggestionItem.classList.add("suggestion-item", "p-2", "cursor-pointer");
                        suggestionItem.textContent = product.name;
                        suggestionItem.onclick = () => {
                            document.getElementById("search").value = product.name;
                            suggestionsContainer.innerHTML = "";
                            suggestionsContainer.classList.add("hidden");
                        };
                        suggestionsContainer.appendChild(suggestionItem);
                    });
                    suggestionsContainer.classList.remove("hidden");
                } else {
                    suggestionsContainer.classList.add("hidden");
                }
            });
    }
</script>

<style>
    #suggestions {
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
    }
    .suggestion-item {
        background-color: white;
        border-bottom: 1px solid #e5e5e5;
    }
    .suggestion-item:hover {
        background-color: #f0f0f0;
    }
</style>

{% endblock %}