{% extends 'base.html' %}
{% load static %} 

{% block meta %}
<title>Bookmark | BaLink</title>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
{% endblock %} 

{% block content %} 

{% include 'navbar.html' %}

<div class="container mx-auto px-6 lg:px-8 my-12">
    <div class="text-center mb-10">
        <h2 class="text-4xl font-bold tracking-tight text-blue-600">Your Bookmarks</h2>
        <p class="text-gray-500 mt-2">Organize your saved items here</p>
    </div>

    <!-- Bookmarks Collection Section -->
    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {% for bookmark in bookmarks %}
        <div class="bg-white rounded-lg shadow-lg p-6 relative">
            <!-- Product Image -->
            <img src="{{ bookmark.product.image.url }}" alt="{{ bookmark.product.name }}" class="w-full h-48 object-cover rounded-lg mb-4">

            <!-- Product Details -->
            <h3 class="text-2xl font-semibold text-gray-800">{{ bookmark.product.name }}</h3>
            <p class="text-gray-500">Saved on: {{ bookmark.created_at|date:"Y-m-d H:i" }}</p>
            <p class="text-gray-500">Priority: {{ bookmark.get_priority_display }}</p>
            <p class="text-gray-500">Reminder: {{ bookmark.reminder|date:"Y-m-d" }}</p>
            <p class="text-gray-700 mt-2">{{ bookmark.note }}</p>

            <!-- Update & Delete Buttons -->
            <div class="flex justify-between mt-4">
                <button class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition" onclick="openUpdateModal('{{ bookmark.id }}')">
                    Update
                </button>
                <form action="{% url 'bookmarks:delete_bookmark' bookmark.id %}" method="post" class="inline-block">
                    {% csrf_token %}
                    <button type="submit" class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 transition">Delete</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Add Bookmark Button -->
    <div class="text-center mt-12">
        <a href="{% url 'bookmarks:create_bookmark' %}" class="bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition">Add New Bookmark</a>
    </div>
</div>

<!-- Modal for Update Bookmark -->
<div id="updateBookmarkModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center">
    <div class="bg-white rounded-lg p-8 w-full max-w-lg">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">Update Bookmark</h3>
        <form id="updateForm" method="POST">
            {% csrf_token %}
            <!-- Note Field -->
            <label for="note" class="block mb-2 text-gray-700 font-medium">Note</label>
            <textarea name="note" id="note" class="w-full border border-gray-300 rounded-lg p-2" rows="4" required>{{ form.note.value }}</textarea>

            <!-- Priority Field -->
            <label for="priority" class="block mt-4 mb-2 text-gray-700 font-medium">Priority</label>
            <select name="priority" id="priority" class="w-full border border-gray-300 rounded-lg p-2">
                <option value="H" {% if form.priority.value == "H" %}selected{% endif %}>High</option>
                <option value="M" {% if form.priority.value == "M" %}selected{% endif %}>Medium</option>
                <option value="L" {% if form.priority.value == "L" %}selected{% endif %}>Low</option>
            </select>

            <!-- Reminder Field -->
            <label for="reminder" class="block mt-4 mb-2 text-gray-700 font-medium">Reminder</label>
            <input type="date" name="reminder" id="reminder" class="w-full border border-gray-300 rounded-lg p-2" value="{{ form.reminder.value }}">

            <!-- Submit Button -->
            <div class="flex justify-end mt-6">
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">Save Changes</button>
                <button type="button" class="ml-4 bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition" onclick="closeModal()">Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
    function openUpdateModal(bookmarkId) {
        document.getElementById("updateBookmarkModal").classList.remove("hidden");
        document.getElementById("updateForm").action = "/bookmarks/update/" + bookmarkId;
    }

    function closeModal() {
        document.getElementById("updateBookmarkModal").classList.add("hidden");
    }
</script>
{% endblock %}